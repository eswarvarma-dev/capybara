workflows:
  default-workflow:
    name: Default Workflow
    environment:
      vars:
        CM_KEYSTORE: Encrypted(Z0FBQUFBQmQ1U0RhS0FZMVpORUszQjItQUtWMy1MLUdjV09LUi1TcFkzYWNaSWphV1U4akNYTGk1Y0lZTnFEWXFMai1IcGo3RFhyTWVXbDBQeWMtZDdYblVQOVlPZzNfYmJYTlFfWEpCRllFTEw0elhhNExNQjZXOFNCMlJ1U19fOVYxQ2VuR2xmY3Q2ZzBSWF9zSGs5Y0J2blhYVFplUlZ5MGFpTU12SWQ2UGlIcFZralpVbnM0MGlsSHhkb3Fld2tIQl96Y3IyLVVXRjRnaVVvVFhCSmhqUVZiY1A3LVVkaGtJZVk5U3p6SjB3bGQzZEVMWjBOQl9IT1UzUHRSX1k2aGdwb1hHRjlUbEhyREVlcXhja1ZpeGpGMTEtN1FxQlM5cDlXbXotdC04N0hiSXNfM0s4Nlh0TVBQc0JvdS13WjMxQUNVZTljWU9MUUczampQUTVEVGhhUWFBdmhPeldEZ0x2VUJMd2paLXZyeGNZWDY0OTJ6b3hOWkdvUlU4V0hOXzllMWFHUThyY3N3N1dOUTVvT3JQTlE4NnlkWUpDNG1SZnJxV1pPVmV2T29DS0l5cVFjdVdDTUhWLS1SYW5JR2hHbG9RUDV5a3JNV29pZGNJQWFSUkNqNEVVZjMtdGVqX09EanBXd2VTczB4NEpQRk96eVk4enZJSmVGdVNrN3ExQ3NTTE84Q1dDOVRDT1o0NVdFR1ZqalExSXY2VVNmN3pNNzdfM1d3am1vbW9STzVLRzRYa3lnUGxQUlJWV190RTJfS2tqbVB6YWtONVEyNlk0RXUtbE9vTkVqNUZmcjZQNF9QSnRqT2h0QWFlY2N5UmhUbFlObWg2a1BjY3F5elNmTnB1OWNuNGgwMWNFMnY5eXlqTGxZa05FN2lzR1ZkdFM2QTBYckt1Q3ZfazJsU3IxcENZUW1XVm95Smk5VmpxeER1Zk5YaTNzUXFXdThjcnpYOWpLb3dUMjJUZzl1WUJIWWJGejdEOXJOUld5NEtUSFBTWDNDVmJHS1lVR3RrV0lpY2JGRk56cHBwci1zV0ZpWlN0ZV9JblhCbFlvcWpSdTFvX3RIYXdjSjM1V015d3FHb0cxUS1aZ2pEcV9JbGlHT2ZEOGY1dGRpWTg1NzFlNnRnWHlyWTVUeFJWdk5tdGxWR0g2eGdPWUtzMWxEY3VJYnZCZnlvck5yYVVFTzVWM0lwMXdRY20xMWVodFRhZGlkZTVnUEt5Q3ItNU1tVXNvc1lNa3JzR3Y5WnltY0FwTFpBMHRVUlZSejUzOU9rQTFOU1BLVlJObzdzY0g3RDAyU2pnUnlEV3BXQXJOSFlHa09VVVdxbEl1bTNsMjVoNExKRHVydVRPdm1yYnBTZ1NINzdLNmNQODY4a2w4VVBkY3pBaU9EZHFMaC1hYVdlYmdxYUFSMDBLa2I1aDNFMG96R0VCZVUtWnRaMzFpa2xhUXRpcld5Qm1WaS1LYW4yZVFJNVRvYnZya3ktbFIxNV9kSGNtWVFUUU03Z0htMnNyRUpUREZaQlJfRUdWOTVZa0JkV1Bqb09SdmJ5ZV9sWEkwRXhnbjhKNFpkNjhFNWxJRHNiRlIycmx6bG5lbmVOdDZuUVFaLXhOVURsTDMyZ3hod0hIb3B1MnJQelVuOWxsTlh6bnoyNVlPc3BTR1MyTThLb1ozeWhyRW1URVlRUmFrb21XVlBuZEJDYzVHRnZ1Q2ExNzNvdjF3emFwUDFCVEw4WjN0TkthVU9xTXlaVDR1WGVhaDI1dTBWb19FVWttb3BScWJZeVNzOTljMWQ4SzA0ZUdHeDlwb0ZqMzdVV2hUNjllaVV2QnJ2WllMdjNZQU5CRXJwSlFwa2FiRmg3dnZCWVpjS21ncDFEM2dxMmZpejRjc0tPZXl4clJSR1dNdjl4Z3ZITGo0MU01MGZDS2NzZ0pkSFBMX3RYWmlyMVZ3d3lUWkVhdFY4d2diWmNReU5NYk14ZjBnbzNaaHpYVEZYZWZma1pwRU5HamF6VUtjVnlDd0xpT3B6M2RyYXFZaVIyM2JUc1RHUjlhZkNycHlTTFZzRmxZMHBOemowQkVEbllVOXVKc0RrUFphYWNrUHZVSHU4TlRDSHo5X1Eybk92NjZaYjJxUGtjbGpVRHF2US1aVUMtd0ZUWmdnZ3dvTzNIcUpBdUEySTdjTEROa0NCRlhOdE5TU0RIZlZsZjhfSjZrUDJmZndFWUM1b3JqN2pST0ZwVWRLdWdOa0dxRDBHZGQtQTh3U3lCQ0Y2M1Jpc1lLTkp3Uk1YS0luc0gwNDFhWnJWdERId1FJeFUzMEdXS2NpOFQ2QkhWWXNiZXZVTWJvOVRxLWRqSUJ5WEdDdXhBUTNPNlV6b092SFFmYWJSZFUzTUFLX3FGaTJUZm42RUxISFNnQlJMaFMwVEd6M3BjUDItc0NnRVd6dVplTk1EY3E5aUVvZlFRN2RmaENmZU9hN0VWUTBHMzh1VjFWSXBmMXBnWmNkbEJET1lYS21ZNjN6Z09IMVU1R2p6aU1MbkFXS01Jak1VdW82bktUblNIWVR3TmF4dlBJWHljV29oSWIyRkZYRHFVM0VEQ2tMbVBlci1TZERaQlFGWjZEOXZ4MzBlS29nMnN1LVNDeUsyQ2RXN1BmN015Vm5wTUtzT1VCc3l6MjY4Njh2R2h0QnNnbnA4MnV6WFNuTXl2b1YzM2Y5WDZaT0czNWZJcGcxUkV1Zm1zREhoUkpub19TNzNnQ1VlQnA4WVhBWUM3X2VZRDFYS0ZKeEl1WTJzVExCb0w5ZUdyWHBNY0V4blgzWVZlTUZocmRMS1o3XzYxZTZTQXV6cWZodmx2X1RiVWNoZnJJTDB5SlVBZjNXZ1VJWndXNnBfcE1xU2pKaFRxRXNaMU1iMFYyTGlMUXFtalh6Wnk1WXNKQVBRZEs1aGtkM0lRY2ktZ0FzWFc5bFhuTWlMU0ZtRjFnT3BXVV9FbzFvdmJ0MWxFYlNJVHBzZ2pSakJrZlo5SXlyVEpuNUV6QXBuSE9rZ2RKUkFfVUhZenRqSUJwX0hPaVlYV1lTVktmWFFIZlpLdW1aUlBXWjl6TG9QazhEZ1NfSmFuYXhleVd2SklSVFQ1N1pSNjVNWHJLOTU5Z3NyWnhCZGFrVXA1cVgxNWFYWTRjbVVKU2xiSzBiNl9WR05VZ09zYVNJeDZVSzNoVmJ4SlpONHZpeGRweWo0aU9XaVo0cEJDcV9ERGpIMDNXeHBmT1BBMDdkR0U0Q3JXM29WdTBoRzlLaTJkRDZ0R09SclYxZmJFcWhRTjBUQ3djMGZVTEVib1pOV0FWOEJKakd5cjFvSVp5Z1pPYzVDTmlhQVpYUzU1bWR0TUVPeW04NUNyTHFzN3dOSURnWl84TVdSakkyU2dXakd3UlRLWTNvdzJaZjU3M3RYMTNrV195eTJVQ2NDN1NxX0ppV0Etcm5FMG1WbjFFMHU5ZzlXSGNwSlRyQkJyeHRCN3N2SHJJcWE0eXN1bDl1RXhvRHVoNWN6OU9Ka1hOR01Wb05QUU1QNkVUOENfRndaSERGOFVicmNNUXVrdHZWUkQ1MXV5NHpBanI0SEVUYWVudEYwMDVMOUM4VUgyYWFqRjlZQkpmdWUtZGZZUnJrNDNjX3FfUzhUX2t6dnNhVWVFT2ZmQ0l4bjB5Nmx2S2IwMkljeUFZQnZ3dTNGT1FuYnlxTVd5Q3R3dHZwSXpUMFFmckliNFo4emg2VjRjcFd5ZjRyM3EzZ0NjU21nNzV2UmJQMEZtLUxmdWdNWWdwcjRFUU0wd2JIOWxQN3g1a1dhWWJhZTdrQkdYb3JxbkZzc3JiSkZpNVdlY3hUSFRRbnNUQmFiT1NaTUFsd0U3RjF6WldoUGZsLUtPR0Fzb0VGZDZlUXdweGJBQzF4Sk5fLWp5OWJRV1pUR2hHUzRKLVdBcmRaYmxOUzNpSnRYajlkdnlIOEtkNnNlN25vcFJCdVVDTVJxSm9STDBmVm12NnNqOFVac2wzTlRabVVKTXM0cWVheEJWZUVTMXFvcGN6bldITEFLdzBkY3NxaW1kVmdyMTJYSk1qZFluQ2ExZnN1N09XNmcxMFVwaGhaeDA3UDhLd3c5dzREQlVBOXY3S1A5LVV3czB6N3N3c3NfRVlwN2VXY19nTlhJMHp0VzhWQWp2QjRVZXV5ME5rQTU0MGlLZXhocUhGWU5tVzI2NVl4ZndxdV9MdzRiQzNHZ1NGMV8yMGw0cHhlRjk3MU1FcktoRGNqSUV4X3RHS0tQbEJQUFFmcFFnWmNZNWExOFFjQmFvbzRnbmJQeV9UZHFSWERmdnlNM0lyQUx3TlpnakF3OFpuZ3V0Y0lZWFdLa25xZ0NLbjFOQlVESzhKUXI5ZExodi1DR0xibmFFQ21fTTgtbmk0cC01NS1QU3JGejBWZlpIWUtSLW1YZXktWWs4X1ZrSWhqX256NUhrZ3lDdVVadkxPSDVLVDFMVHdDMFlQREg3U2xJX2g2T01oX1lJb0h5d1FUdWJnaWlEbmVJVjhHcWh1TGtpR3NMTExLaVFNaFlfdUFQRFNmMlBVMVRjNmFCNEEyc3lBSldwdHk4RUZSc21DWkdjNWhQOWVRRGs3bzhoVTB5elFQQkp2eGhFOWNTT2RvNXMtc2d2eXEyVkdvdmtoT19VenpkdUJYcDI5SlpHQ3ZPUDhhb0cwTW1vWGx0VmoyS1ZSSUN4cnZ4RXJMQ1cycnU3RUU5d0h4eXNwcnBDSUMtTWZwMXFZSm5hYTNQVkJ5czZ6c0lUaUg2UTVQUENTaDFxcUpZa05FMWtoUWJQUmNsNnUtaFI1ZmpWbVFROFVRbTYtRl9wTHByWUpwQlFlTWhiSjAyVlhHclZRSHZWZER3R1dINVJMRFNxM3FPS0V1RERkVWZOUTJzMTd0MnE2blhUVThxUWN4MFpEeUdMb3hOU2xNaVJUVjVYa05EQWZoSW1jWkhnT3ROSkZuSk5KTWVTbVNoZmNPMnJUNFhVRU95MlVsN3pMZVJ1Q1E1RWpucnEyQUxuOHZBNkdua1Q4M2lrME9fcS00YUY1cXhRb09jaUJoWWVRNGxfbnpaTHVBd2lUbTUzX2l5eHo3dVMtXzR5ZVBUZS1BOEFHLXhaWkp6aGFPZGNiQWFzanhfcldwNlZ0MmN5Z3pFS1MxcFFBT2J0X0RNRk9CeDRBSmUwQzZMSVN0MG56aVVSNVVxV2xDZERoUi1SVVZjUXF4dnFGallzVDVZWVMxQTBuNlJkQVpsVnlhbU1Wa1RBTG81UGhuOXNEaFo3ZUg3LXpYdmJkM3owVUlwbDJyNlVNM1pfUFVxY0EzclpTcTlpT3Z2VGhkNFRnUllLZVJJYXhOY01MRDZGU0pUZkl2NFZWMVhZWlNaUzJWX1Vka2hsQlVpWWp2QWZZVzB5QmxYOFI4eFR5WGlsWGpJZ3FZQWdJZ2hEOEJrZmRRUkh6Y3lSSUx6RThsWXRLNEJFSzRycFJMYzBHcEFCLTkxR3E1b2tTWGdOY0g2dE5fTEw0TlV6NlFVTjYyaHZ4YzdzTXdRRmVoU3pmVHk2R0ZkS0xqTFMycHVuZGhQZU5xTGZoRzM1VmxWWmVMY1hmWWxrYmJsNElIc1lsU3NHd0p2ejA2MC1RQWVvVnFJT3dhdE9YTHFEZHJUM2xkRGswbndPNmJiTG5RTzUtbnJ0MkJ2RXRzSmtrTnV5am0xaDNTakN5SUxSYV9HdU03M0ZjaFNUeTZBZG5mVGdNWHpKYU1kT1ZEUkRSSTFBcWZyRlBGVlNkUFhpWHBES0ZTaVNONnNKdTREZnJPYURZZlpWX1libDU5MEQzTC1PUjdKLVJ6U0ZLanR3UXhWMmJtR25wbGVoRU1CTGVPSTFFZXlXSlNMUTduYlFiSVh5TjVtem1UTGFDeWlzbi00UlpFbHFMYTJPRGdDMHgwNUltVldMMmVjRTMwcG9Nc2JVOHd6UEItRGdhV2tsYmo5VTVrdHJHWFZWZ0NqZnRBenoxSjY0Wk1CRGhybXlBYlVDMEZqMV9GREFHdTdlN090UnRBYkNTWGgwWkttU1hNNFhyQU5fUE52QVpXQmNOdmhlUl9jSWlrcFJmWVF3NXJSb3NhQjJReWEyWmxZRHBsSFVIcjV0cHFxaURRWGhxQmtIUy1lQUJrU1NfTmdBNjhFZmxLMWRsYzNkNzhKNUF1NjVPT1N3dVcycV9IUXJWQnNtdmQ5OD0=)
        CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmQ1U0RhWlBJczZZbEllX2U4WjhjUktFY2ctcm1PVTZ1Y3lIWmJaMWI3TC1YOHV2bmhNQ0F5NmZVZVQwMmd1SWpDVzZzalRIV1RZN3hqcHpEODRXb0Z3LTFqY2c9PQ==)
        CM_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmQ1U0RhVWgwTnpndy11OEtSUlNKM1BnYmVScVZnREJycS00VXVXbTlBX3NiSmVKeS1HeXR1YVo0ckEybVZmZS1MbzVnOEZDYnVsb1JMUGIzLS1NSTdJYVBRNkE9PQ==)
        CM_KEY_ALIAS_USERNAME: Encrypted(Z0FBQUFBQmQ1U0RhR0FPdEx0bEE3NnNUNTQxZVVLVnFRd0R3WmlidVRiR28tZXRnOGxXSHNqUW5tS3ZxeVcxeDJYOHRtOUFzODJfLXUxUW1GU09EeXJobmNmeE5fYmJRNUE9PQ==)
      flutter: stable
    scripts:
      - |
        # fetch codemagic helper scripts
        rm -rf ~/codemagic-build-scripts
        git clone https://github.com/NevercodeHQ/codemagic-build-scripts.git ~/codemagic-build-scripts/ --depth 1
      - |
        # set up key.properties
        echo $CM_KEYSTORE | base64 --decode > /tmp/keystore.keystore
        cat >> "$FCI_BUILD_DIR/android/key.properties" <<'EOF'
        storePassword=$CM_KEYSTORE_PASSWORD
        keyPassword=$CM_KEY_ALIAS_PASSWORD
        keyAlias=$CM_KEY_ALIAS_USERNAME
        storeFile=/tmp/keystore.keystore
        EOF
      - |
        # set up local properties
        echo "flutter.sdk=$HOME/programs/flutter" > "$FCI_BUILD_DIR/android/local.properties"
      - flutter packages pub get
      - flutter build appbundle --release
      - |
        # generate signed universal apk with user specified keys
        ~/codemagic-build-scripts/android/generate-universal-apks \
          --ks /tmp/keystore.keystore \
          --ks-pass $CM_KEYSTORE_PASSWORD \
          --ks-key-alias $CM_KEY_ALIAS_USERNAME \
          --key-pass $CM_KEY_ALIAS_PASSWORD \
          --pattern 'build/**/outputs/**/*.aab'
    artifacts:
      - build/**/outputs/**/*.apk
      - build/**/outputs/**/*.aab
      - build/**/outputs/**/mapping.txt
      - flutter_drive.log
    publishing:
      email:
        recipients:
          - bondarenko.stanislav.96@gmail.com
